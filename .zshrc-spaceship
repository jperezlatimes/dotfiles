# -------------------------------------------------------------------
# Base Setup
# -------------------------------------------------------------------

# Install oh my zsh
if [ ! -d ~/.oh-my-zsh ]; then
  curl -L http://install.ohmyz.sh | sh
fi
export ZSH=~/.oh-my-zsh

# Install spaceship theme
if [ ! -d $ZSH_CUSTOM/themes/spaceship-prompt ]; then
  sudo git clone https://github.com/denysdovhan/spaceship-prompt.git "$ZSH_CUSTOM/themes/spaceship-prompt"
  sudo ln -s "$ZSH_CUSTOM/themes/spaceship-prompt/spaceship.zsh-theme" "$ZSH_CUSTOM/themes/spaceship.zsh-theme"
fi 

ZSH_THEME="spaceship"
HYPHEN_INSENSITIVE="true"
ENABLE_CORRECTION="true"
COMPLETION_WAITING_DOTS="true"
DISABLE_UNTRACKED_FILES_DIRTY="true"

# -------------------------------------------------------------------
# History file
# -------------------------------------------------------------------
if [ ! -f ~/.dotfiles/.zhist ]; then
  touch ~/.dotfiles/.zhist
fi
HISTFILE=~/.dotfiles/.zhist

# -------------------------------------------------------------------
# Options
# -------------------------------------------------------------------
setopt extended_history         # Also record time and duration of commands.
setopt share_history            # Share history between multiple shells
setopt hist_find_no_dups        # Dont display duplicates during searches.
setopt hist_ignore_dups         # Ignore consecutive duplicates.

# -------------------------------------------------------------------
# Completions
# -------------------------------------------------------------------
autoload -Uz compinit
compinit

# -------------------------------------------------------------------
# Bundled plugins
# -------------------------------------------------------------------
plugins=(
  git
  pip
  npm
  node
  sudo
  history
  redis-cli
  docker
  docker-compose
  common-aliases
  colorize
  archlinux
)
source $ZSH/oh-my-zsh.sh

# -------------------------------------------------------------------
# Custom plugins
# -------------------------------------------------------------------
#if [ ! -d $ZSH_CUSTOM/plugins/zsh-completions ]; then
#	sudo git clone https://github.com/zsh-users/zsh-completions $ZSH_CUSTOM/plugins/zsh-completions	
#fi

#if [ ! -d $ZSH_CUSTOM/plugins/zsh-autosuggestions ]; then
#	sudo git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions
#fi

# -------------------------------------------------------------------
# Aliases
# -------------------------------------------------------------------
alias search="sudo find / -name"
alias zshconfig="vim ~/.zshrc"
alias zshupdate="source ~/.zshrc"

# Set Java Home var
export JAVA_HOME=/usr/lib/jvm/default || echo "JVM not installed"

# Install NVM
if [ ! -d ~/.nvm ]; then
	curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
fi

# Setup NVM with completions
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# Function to install an AUR repo package
# TODO: Move this to it's own shell file
auryn() {
  if [ -z "$1" ]; then
    echo "No AUR package specified"
  else
    cd ~/Downloads
    git clone "https://aur.archlinux.org/$1.git"
    cd "$1"
    makepkg -Acs && sudo pacman -U *.pkg.tar.xz
    cd ~/Downloads && sudo rm -r "$1" 
 fi
}

# Ship a python package to different pypi profiles
ship() {
  if [ "$1" == "publish" ]; then
    python setup.py sdist bdist_wheel
    twine upload dist/*
  elif [ -z $1 ]; then
    python setup.py sdist bdist_wheel
    twine upload dist/* --skip-existing
  else
    echo "shipping library $1"
    python setup.py sdist bdist_wheel
    twine upload dist/* -r "$1" --skip-existing
  fi
}
